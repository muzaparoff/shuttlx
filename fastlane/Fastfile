default_platform(:ios)

platform :ios do

  # --------------------------------------------------------------------------
  # test â€” Build and run tests on iOS and watchOS simulators
  # --------------------------------------------------------------------------
  desc "Build and test both iOS and watchOS targets on simulators"
  lane :test do
    # Build and test iOS
    scan(
      project: "ShuttlX.xcodeproj",
      scheme: "ShuttlX",
      destination: "generic/platform=iOS Simulator",
      clean: true,
      build_for_testing: true
    )

    # Build watchOS (watchOS does not support XCTest execution on simulators,
    # so we only verify it compiles)
    xcodebuild(
      project: "ShuttlX.xcodeproj",
      scheme: "ShuttlX Watch App",
      sdk: "watchsimulator",
      destination: "generic/platform=watchOS Simulator",
      build_settings: {
        "CODE_SIGNING_ALLOWED" => "NO"
      },
      xcargs: "clean build"
    )

    UI.success("Both iOS and watchOS targets built successfully.")
  end

end
